!function(a){var r,i,o,s,c=a.kaixin={appType:"kaixin"},d={loadingProgress:0,interstitialAdLimit:0,rewardVideoAdLimit:0,bannerAdLimit:0},u="interstitial",f="rewardVideo",g="banner",l=!1,y=!1,m=!1,p=0,h=0,A=!1,t={2001:"当前环境不支持此方法",2002:"showAsync,激励视频广告显示过多，请稍后再试",2003:"showAsync,插屏广告显示过多，请稍后再试",2004:"setLoadingProgress,加载进度必须为数值类型",2005:"当前广告还未加载完成",2006:"请在initializeAsync方法后执行此方法",2007:"setDataAsync仅允许存储字符串或者数值数据",2008:"setDataAsync存储的数据不能超过128个字符",2009:"banner广告位id不能为空",2010:"purchaseAsync:商品id不能为空",2011:"consumePurchaseAsync:消耗的商品购买token不能为空",2012:"排行榜分数只能为数值类型",2013:"getDataAsync方法的key仅支持字符串",2014:"广告位id不能为空",2015:"插屏或激励视频广告不能调用hideBannerAsync",2016:"showAsync,banner广告显示过多，请稍后再试",2017:"购买商品前请先获取商品列表",2018:"商品列表不存在，请前往管理后台添加支付相关的商品",2019:"商品id不存在，请保证商品id真实且存在",2020:"当前版本不支持支付功能，请升级客户端",2021:"参数格式不正确"},v="https://cdn-heyshell-com.akamaized.net/xyxnew/dev/static/images/nouser.png",n=!1,S=!1,w={},k=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],I=["911004124","911004803","911004107","911004437","911004101","911004697","911004317","911004643","911004751","911004147","911004724","911004251","911004748","911004066","911004162","911004728","911004090","911004174","911004060","911004867","911004094","911004625","911004423","911004847","911004556","911004290","911004600","911004588","911004055","911004633","911004917","911004540","911004024","911004397","911004627","911004880"];function P(e,n){if(A)return!0;(void 0===e&&(e="unknown"),console.log(JSON.stringify(B(2006))+","+e),void 0!==n)&&n(B(2006));return!1}function T(){return n||S}c.player={},c.player.name="username",c.player.photo=v,c.player.id="uid",c.player.getName=function(){if(P("getName"))return c.player.name},c.player.getPhoto=function(){if(P("getPhoto"))return c.player.photo},c.player.getID=function(){if(P("getID"))return c.player.id},c.player.getSignedPlayerInfoAsync=function(r){return new Promise(function(n,t){if(P("getSignedPlayerInfoAsync")){void 0===r&&(r="");var e=new Date,s=parseInt(e.getTime());W({url:D+"/sdk/appAuthOrderStatus/",data:{game_id:N,token:O,request_payload:r,player_id:c.player.id,issued_at:s},success:function(e){200==(e=JSON.parse(e)).code?n(e.msg):t(e)},error:function(e){t(e)}})}})},c.systemInfo={},c.systemInfo.deviceWidth=0,c.systemInfo.deviceHeight=0,c.systemInfo.version=0;var b,M=!1,N="",O="",x="",D="",L="测试游戏",E="portrait";function C(){this.name=""}function _(e,n,t,s){this.bannerId=e,this.adType=n,this.style=void 0===t||null==t?{left:0,top:0,width:0,height:0}:t,this.brandType=1,void 0!==s&&(this.brandType=s),void 0===this.style.left&&(this.style.left=0),void 0===this.style.top&&(this.style.top=0),void 0===this.style.width&&(this.style.width=0),void 0===this.style.height&&(this.style.height=0)}function J(e){return-1!=I.indexOf(e.toString())}function R(){var e,n=(e="unknown",a.location.href,/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?e="ios":/(Android)/i.test(navigator.userAgent)&&(e="android"),e);if("ios"==n);else if("android"==n)return"undefined"!=typeof MessengerSender?MessengerSender:(alert("MessengerSender is undefined"),null);return null}function B(e){var n={};return n.code=e,n.msg=t[e],n}function V(){return function(){for(var e="",n=0;n<5;n++){var t=Math.ceil(35*Math.random());e+=k[t]}return e}()+""+(new Date).getTime()}c.systemInfo.getWidth=function(){if(P("kaixin.systemInfo.getWidth"))return c.systemInfo.deviceWidth},c.systemInfo.getHeight=function(){if(P("kaixin.systemInfo.getHeight"))return c.systemInfo.deviceHeight},c.systemInfo.getAppVersion=function(){if(P("kaixin.systemInfo.getAppVersion"))return c.systemInfo.version},c.initializeAsync=function(e){return null==e&&(e=!1),n=e,function(){D="https://hifunapi.kaixin001.com",H="https://hifunsdk.kaixin001.com",c.systemInfo.version=0,c.systemInfo.deviceWidth=a.innerHeight,c.systemInfo.deviceHeight=a.innerWidth,N=F("gameId")?parseInt(F("gameId")):10042;if("link"==F("type")){N=parseInt(F("gameId"));var e=parseInt(F("env"));H=1==e?(D="https://hifunapi.kaixin001.com","https://hifunsdk.kaixin001.com"):(D="https://hifunapi-test.kaixin001.com","https://hifunsdk-test.kaixin001.com"),c.systemInfo.version=0,c.systemInfo.deviceWidth=a.innerHeight,c.systemInfo.deviceHeight=a.innerWidth,M=!(S=!0)}}(),!n&&a.MessengerSender&&(a.MessengerSender.initializeAsync=function(e,n){q("initializeAsync",e,n)},a.MessengerSender.setLoadingProgress=function(e,n){q("setLoadingProgress",e,n)},a.MessengerSender.startGameAsync=function(e,n){q("startGameAsync",e,n)},a.MessengerSender.shareAsync=function(e,n){q("shareAsync",e,n)},a.MessengerSender.player=function(e,n){q("player",e,n)},a.MessengerSender.getRewardedVideoAsync=function(e,n){q("getRewardedVideoAsync",e,n)},a.MessengerSender.getInterstitialAdAsync=function(e,n){q("getInterstitialAdAsync",e,n)},a.MessengerSender.getBannerAdAsync=function(e,n){q("getBannerAdAsync",e,n)},a.MessengerSender.hideBannerAsync=function(e,n){q("hideBannerAsync",e,n)},a.MessengerSender.loadAsync=function(e,n){q("loadAsync",e,n)},a.MessengerSender.showAsync=function(e,n){q("showAsync",e,n)},a.MessengerSender.canCreateShortcutAsync=function(e,n){q("canCreateShortcutAsync",e,n)},a.MessengerSender.createShortcutAsync=function(e,n){q("createShortcutAsync",e,n)},a.MessengerSender.getLeaderboardAsync=function(e,n){q("getLeaderboardAsync",e,n)},a.MessengerSender.getEntryCountAsync=function(e,n){q("getEntryCountAsync",e,n)},a.MessengerSender.setScoreAsync=function(e,n){q("setScoreAsync",e,n)},a.MessengerSender.getPlayerEntryAsync=function(e,n){q("getPlayerEntryAsync",e,n)},a.MessengerSender.getEntriesAsync=function(e,n){q("getEntriesAsync",e,n)},a.MessengerSender.setDataAsync=function(e,n){q("setDataAsync",e,n)},a.MessengerSender.getDataAsync=function(e,n){q("getDataAsync",e,n)},a.MessengerSender.getName=function(e,n){q("getName",e,n)},a.MessengerSender.getPhoto=function(e,n){q("getPhoto",e,n)},a.MessengerSender.getID=function(e,n){q("getID",e,n)},a.MessengerSender.showBannerAd=function(e,n){q("showBannerAd",e,n)},a.MessengerSender.hideBannerAd=function(e,n){q("hideBannerAd",e,n)},a.MessengerSender.paymentReady=function(e,n){q("paymentReady",e,n)},a.MessengerSender.getCatalogAsync=function(e,n){q("getCatalogAsync",e,n)},a.MessengerSender.purchaseAsync=function(e,n){q("purchaseAsync",e,n)},a.MessengerSender.getPurchasesAsync=function(e,n){q("getPurchasesAsync",e,n)},a.MessengerSender.consumePurchaseAsync=function(e,n){q("consumePurchaseAsync",e,n)},a.MessengerSender.gotoAndroidScore=function(e,n){q("gotoAndroidScore",e,n)},a.MessengerSender.apkDownLoad=function(e,n){q("apkDownLoad",e,n)}),T()?new Promise(function(e,n){var t,s,r,i=function(e){if("undefined"!=typeof Storage)return localStorage.getItem(e)}("platform_token_os");i&&""!=i?(s=e,r=n,W({url:D+"/user/getOne/",data:{token:t=O=i},success:function(e){200==(e=JSON.parse(e)).code?(c.player.name=e.msg.nickname,c.player.photo=e.msg.avatar,c.player.id=e.msg.uid,e.msg.avatar&&(c.player.photo=e.msg.avatar.replace(/thirdqq.qlogo.cn/,"mgres.kaixin001.com.cn/wechat_image")),W({url:H+"/sdk/getAccessToken/",data:{token:t,gameId:N},success:function(e){200==(e=JSON.parse(e)).code?(A=!0,x=e.msg,s()):z(s,r)},error:function(e){z(s,r)}})):z(s,r)},error:function(e){z(s,r)}})):z(e,n)}):new Promise(function(n,t){R()?R().initializeAsync({},function(e){!0,200==e.code?(A=!0,e.msg.name&&(e.msg.photo?e.msg.photo=e.msg.photo.replace(/thirdqq.qlogo.cn/,"mgres.kaixin001.com.cn/wechat_image"):e.msg.photo=v,c.player.name=e.msg.name,c.player.photo=e.msg.photo,c.player.id=e.msg.id,c.systemInfo.deviceWidth=e.msg.width,c.systemInfo.deviceHeight=e.msg.height,M=e.msg.isTest,N=e.msg.gameId,O=e.msg.token,x=e.msg.accessToken,D=e.msg.domain,L=e.msg.gameName,E=e.msg.orient,e.msg.versioncode&&(c.systemInfo.version=parseInt(e.msg.versioncode)),M&&(console.log=(console.log,function(e){alert(e)}))),n()):t(e)}):t(B(2001))})},c.setLoadingProgress=function(e){if("number"==typeof e){if(P("setLoadingProgress")&&!T()&&e>d.loadingProgress&&(d.loadingProgress=e,R())){var n={};n.progress=e,R().setLoadingProgress(n,function(e){})}}else console.log(JSON.stringify(B(2004)))},c.startGameAsync=function(){return new Promise(function(n,t){P("startGameAsync",t)&&(T()?n():R()?R().startGameAsync({},function(e){200==e.code?n():t(e)}):t(B(2001)))})},c.shareAsync=function(e){return new Promise(function(n,t){P("shareAsync",t)&&(T()?t(B(2001)):R()?(!1,R().shareAsync(e,function(e){!0,200==e.code?n():t(e)})):t(B(2001)))})},c.canCreateShortcutAsync=function(){return new Promise(function(n,t){P("canCreateShortcutAsync",t)&&(T()?n():R()?R().canCreateShortcutAsync({},function(e){200==e.code?n(e.msg):t(e)},function(e){t(e)}):t(B(2001)))})},c.createShortcutAsync=function(){return new Promise(function(n,t){P("createShortcutAsync",t)&&(T()?n():R()?R().createShortcutAsync({},function(e){200==e.code?n():t(e)},function(e){t(e)}):t(B(2001)))})},C.prototype.getName=function(){return this.name},C.prototype.getEntryCountAsync=function(){return T()?new Promise(function(n,t){W({url:H+"/sdk/getRankCount/",data:{gameId:N,token:O,accessToken:x},success:function(e){console.log("getEntryCountWeb:"+e),200==(e=JSON.parse(e)).code?n(e.msg):t(e)},error:function(e){e=JSON.parse(e),t(e)}})}):new Promise(function(n,t){P("getEntryCountAsync",t)&&(R()?R().getEntryCountAsync({},function(e){200==e.code?n(e.msg):t(e)}):t(B(2001)))})},C.prototype.setScoreAsync=function(i){return new Promise(function(n,t){if(P("setScoreAsync",t))if("number"==typeof i){if(T())return s=n,r=t,void W({url:H+"/sdk/setRankListScore/",data:{gameId:N,token:O,accessToken:x,score:i},success:function(e){200==(e=JSON.parse(e)).code?s():r(e)},error:function(e){e=JSON.parse(e),r(e)}});var s,r;if(R()){var e={};e.score=i,R().setScoreAsync(e,function(e){200==e.code?n():t(e)})}else t(B(2001))}else t(B(2012))})},C.prototype.getPlayerEntryAsync=function(i){return new Promise(function(n,t){if(P("getPlayerEntryAsync",t)){if(T())return null==i&&(i=!0),s=n,r=t,void W({url:H+"/sdk/getUserRank/",data:{gameId:N,token:O,accessToken:x,isDesc:i},success:function(e){200==(e=JSON.parse(e)).code?s(e.msg):r(e)},error:function(e){e=JSON.parse(e),r(e)}});var s,r;if(R()){null==i&&(i=!0);var e={};e.isDescend=i,R().getPlayerEntryAsync(e,function(e){200==e.code?n(e.msg):t(e)})}else t(B(2001))}})},C.prototype.getEntriesAsync=function(i,o,a){return new Promise(function(t,s){if(P("getEntriesAsync",s)){if(T())return null==i&&(i=10),null==o&&(o=0),null==a&&(a=!0),n=t,r=s,void W({url:H+"/sdk/getRankList/",data:{gameId:N,token:O,accessToken:x,everyPageNum:i,offset:o,isDesc:a},success:function(e){200==(e=JSON.parse(e)).code?n(e.msg):r(e)},error:function(e){e=JSON.parse(e),r(e)}});var n,r;if(R()){null==i&&(i=10),null==o&&(o=0),null==a&&(a=!0);var e={};e.count=i,e.offset=o,e.isDescend=a,R().getEntriesAsync(e,function(e){if(200==e.code){for(var n=0;n<e.msg.length;n++)""==e.msg[n].photo&&(e.msg[n].photo=v);t(e.msg)}else s(e)})}else s(B(2001))}})},c.getLeaderboardAsync=function(){return new Promise(function(n,t){if(P("getLeaderboardAsync",t))return T()?(s=new C,void n(s)):void(R()?R().getLeaderboardAsync({},function(e){200==e.code?(s=new C,n(s)):t(e)}):t(B(2001)))})},c.player.setDataAsync=function(i,o){return new Promise(function(n,t){if(P("setDataAsync",t))if("string"==typeof o||"number"==typeof o)if(128<o.length)t(B(2008));else{if(o.toString().match(/[\r\n'\\\"{}]/))t(B(2021));else{if(T())return s=n,r=t,void W({url:H+"/sdk/setCacheData/",data:{gameId:N,token:O,accessToken:x,dataKey:i,dataValue:o},success:function(e){200==(e=JSON.parse(e)).code?s():r(e)},error:function(e){e=JSON.parse(e),r(e)}});var s,r;if(R()){var e={};e.key=i,e.value=o,R().setDataAsync(e,function(e){200==e.code?n():t(e)})}else t(B(2001))}}else t(B(2007))})},c.player.getDataAsync=function(i){return new Promise(function(n,t){if(P("getDataAsync",t))if("string"==typeof i){if(T())return s=n,r=t,void W({url:H+"/sdk/getCacheData/",data:{gameId:N,token:O,accessToken:x,dataKey:i},success:function(e){200==(e=JSON.parse(e)).code?s(e.msg):r(e)},error:function(e){e=JSON.parse(e),r(e)}});var s,r;if(R()){var e={};e.key=i,R().getDataAsync(e,function(e){200==e.code?n(e.msg):t(e)})}else t(B(2001))}else t(B(2013))})},_.prototype.loadAsync=function(){var n=this.bannerId,r=this.adType,i=this.brandType;return new Promise(function(t,s){if(!T()&&P("loadAsync",s)){if(r==u&&0!=p){if(parseInt((new Date).getTime()/1e3)-p<=60)return void s(B(301));p=0}else if(r==f&&0!=h){if(parseInt((new Date).getTime()/1e3)-h<=60)return void s(B(301));h=0}if(R()){var e={};e.id=n,e.type=r,e.brandType=i,R().loadAsync(e,function(e){if(200==e.code)r==u?l=!0:r==f?y=!0:r==g&&(m=!0),t();else{if(301==e.code){var n=new Date;r==u?p=parseInt(n.getTime()/1e3):r==f&&(h=parseInt(n.getTime()/1e3))}s(e)}})}else s(B(2001))}})},_.prototype.showAsync=function(){var s=this.bannerId,r=this.adType,i=this.style,o=this.brandType;return new Promise(function(n,t){if(!T()&&P("ad showAsync",t))if(R()){if(r==u){if(!l)return void t(B(2005));0<d.interstitialAdLimit?t(B(2003)):d.interstitialAdLimit=1}else if(r==f){if(!y)return void t(B(2005));0<d.rewardVideoAdLimit?t(B(2002)):d.rewardVideoAdLimit=1}else if(r==g){if(!m)return void t(B(2005));0<d.bannerAdLimit?t(B(2016)):d.bannerAdLimit=1}var e={};e.id=s,e.brandType=o,r==g&&(e.left=i.left,e.top=i.top,e.width=i.width,e.height=i.height),R().showAsync(e,function(e){200==e.code?n():t(e),r==u?l=!1:r==f&&(y=!1)})}else t(B(2001))})},_.prototype.isLoaded=function(){return this.adType==u?l:this.adType==f?y:this.adType==g?m:void 0},_.prototype.hideBannerAsync=function(){var s=this.bannerId,r=this.adType;return new Promise(function(n,t){if(!T()&&P("hideBannerAsync",t))if(r==g)if(R()){var e={};e.id=s,R().hideBannerAsync(e,function(e){200==e.code?(d.bannerAdLimit=0,n()):t(e)})}else t(B(2001));else t(B(2015))})},c.getInterstitialAdAsync=function(n){return new Promise(function(t,s){if(!T()&&P("getInterstitialAdAsync",s))if(null!=n)if(R()){var e={};e.id=this.bannerId,J(n)?R().getInterstitialAdAsync(e,function(e){200==e.code?(r=new _(n,u),t(r)):s(e)}):W({url:D+"/advertise/getGameAd/",data:{token:O,innerId:parseInt(n)},success:function(n){200==(n=JSON.parse(n)).code?R().getInterstitialAdAsync(e,function(e){200==e.code?(r=new _(n.msg.outerId,u,null,n.msg.advertiser),t(r)):s(e)}):s(n)},error:function(e){s(e)}})}else s(B(2001));else s(B(2014))})},c.getRewardedVideoAsync=function(n){return new Promise(function(t,s){if(!T()&&P("getRewardedVideoAsync",s))if(null!=n)if(R()){var e={};e.id=this.bannerId,J(n)?R().getRewardedVideoAsync(e,function(e){200==e.code?(i=new _(n,f),t(i)):s(e)}):W({url:D+"/advertise/getGameAd/",data:{token:O,innerId:parseInt(n)},success:function(n){200==(n=JSON.parse(n)).code?R().getRewardedVideoAsync(e,function(e){200==e.code?(i=new _(n.msg.outerId,f,null,n.msg.advertiser),t(i)):s(e)}):s(n)},error:function(e){s(e)}})}else s(B(2001));else s(B(2014))})},c.getBannerAdAsync=function(n,r){return new Promise(function(t,s){if(!T()&&P("getBannerAdAsync",s))if(null!=n)if(R()){var e={};e.id=this.bannerId,e.left=r.left,e.top=r.top,e.width=r.width,e.height=r.height,J(n)?R().getBannerAdAsync(e,function(e){200==e.code?(o=new _(n,g,r),t(o)):s(e)}):W({url:D+"/advertise/getGameAd/",data:{token:O,innerId:parseInt(n)},success:function(n){200==(n=JSON.parse(n)).code?(console.log("sdk, getBanner:"+JSON.stringify(e)),R().getBannerAdAsync(e,function(e){200==e.code?(o=new _(n.msg.outerId,g,null,n.msg.advertiser),t(o)):s(e)})):s(n)},error:function(e){s(e)}})}else s(B(2001));else s(B(2014))})},c.payments={},c.payments.onReady=function(){return new Promise(function(e,n){T()||P("kaixin.payments.onReady",n)&&(G(7)?R()?e():n(B(2001)):n(B(2020)))})},c.payments.getCatalogAsync=function(){return new Promise(function(i,o){T()||P("kaixin.payments.getCatalogAsync",o)&&(G(7)?R()?R().getCatalogAsync({},function(e){if(200==e.code){for(var n=[],t=0;t<e.msg.length;t++){var s={},r=e.msg[t];s.productID=r.id,s.price=r.money,s.productName=r.name,n.push(s)}i(b=n)}else o(e)}):o(B(2001)):o(B(2020)))})},c.payments.purchaseAsync=function(o,a){return new Promise(function(n,t){if(!T()&&P("kaixin.payments.purchaseAsync",t))if(G(7))if(void 0!==o)if(void 0!==b)if(0!=b.length){for(var e=-1,s=0;s<b.length;s++){var r=b[s];r.productID==parseInt(o)&&(e=r.price)}if(-1!=e){void 0===a&&(a="");if(a.match(/[\r\n'\\\"{}]/))t(B(2021));else if(R()){var i={};i.productID=o,i.price=e,i.developerPayload=a,R().purchaseAsync(i,function(e){200==e.code?n(e.msg):t(e)})}else t(B(2001))}else t(B(2019))}else t(B(2018));else t(B(2017));else t(B(2010));else t(B(2020))})},c.payments.getPurchasesAsync=function(){return new Promise(function(i,o){T()||P("kaixin.payments.getPurchasesAsync",o)&&(G(7)?R()?R().getPurchasesAsync({},function(e){if(200==e.code){for(var n=[],t=0;t<e.msg.length;t++){var s={},r=e.msg[t];s.productID=r.goods_id,s.purchaseToken=r.in_trade_no,s.purchaseTime=r.a_time,s.developerPayload=r.developerPayload,s.signedRequest=r.signedRequest,n.push(s)}i(n)}else o(e)}):o(B(2001)):o(B(2020)))})},c.payments.consumePurchaseAsync=function(n){return new Promise(function(t,s){if(!T()&&P("kaixin.payments.consumePurchaseAsync",s))if(G(7))if(void 0!==n)if(R()){var e={};e.purchaseToken=n,R().consumePurchaseAsync(e,function(e){if(200==e.code){var n=e.msg;t(n)}else s(e)})}else s(B(2001));else s(B(2011));else s(B(2020))})},a.adClose=function(e){e==u?d.interstitialAdLimit=0:e==f&&(d.rewardVideoAdLimit=0)},c.gotoAndroidScore=function(){return new Promise(function(e,n){if(!T()&&P("kaixin.gotoAndroidScore",n))if(R()){R().gotoAndroidScore({},function(){})}else n(B(2001))})},c.apkDownLoad=function(s){if(!(c.systemInfo.version<11))return new Promise(function(e,n){if(!T()&&P("kaixin.apkDownLoad",n))if(R()){var t={};t.downLoadUrl=s,R().apkDownLoad(t,function(){})}else n(B(2001))})};var H;a.sdk_nativeCallback=function(n,t){var e=JSON.parse(t);try{w[n]&&(w[n](e),w[n]=null)}catch(e){alert("sdk_nativeCallback:"+e+",data:"+t+",funcName:"+n)}};function q(e,n,t){if(n)if(t){var s=e+=V();w[s]=t,MessengerSender.native_launchFunc(s,JSON.stringify(n))}else alert("必须传入回调function");else alert("必须传入data")}function G(e){return c.systemInfo.version>=e}function W(e){var t={timeout:5e3,method:"POST",data:null,async:!0,url:"",success:function(){},error:function(){}},n="",s=function(){try{return new XMLHttpRequest}catch(e){try{return ActiveXobject("Msxml12.XMLHTTP")}catch(e){try{return ActiveXobject("Microsoft.XMLHTTP")}catch(e){return null}}}return null}();if(e)for(var r in e)t[r]=e[r];if(null!=t.data){var i=[];for(var r in t.data)i.push(r+"="+encodeURIComponent(t.data[r]));n=i.join("&")}if(null!=s){"GET"==t.method&&(/\?/.test(t.url)?t.url+="&"+n:t.url+="?"+n),s.onabort=function(e){t.error(s.status,"abort "+s.statusText)},s.onerror=function(e){t.error(s.status,"error "+s.statusText)},s.open(t.method,t.url,t.async);var o=a.setTimeout(function(){s.abort()},t.timeout);s.onload=function(e){a.clearTimeout(o);var n=void 0!==s.status?s.status:200;200===n||204===n||0===n?t.success(s.responseText):t.error(s.status,"other "+s.statusText)},"POST"==t.method?(s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(n)):s.send()}else t.error(0,"xmlhttp is null")}function F(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=a.location.search.substr(1).match(n);return null!=t?unescape(t[2]):null}function z(n,t){W({url:D+"/login/guest/",success:function(e){200==(e=JSON.parse(e)).code?(O=e.msg.token,W({url:D+"/user/getOne/",data:{token:O},success:function(e){200==(e=JSON.parse(e)).code?(c.player.name=e.msg.nickname,c.player.photo=e.msg.avatar,c.player.id=e.msg.uid,e.msg.avatar&&(c.player.photo=e.msg.avatar.replace(/thirdqq.qlogo.cn/,"mgres.kaixin001.com.cn/wechat_image")),W({url:H+"/sdk/getAccessToken/",data:{token:O,gameId:N},success:function(e){200==(e=JSON.parse(e)).code?(A=!0,x=e.msg,n()):t(e)},error:function(e){t(JSON.parse(e))}})):t(e)},error:function(e){t(JSON.parse(e))}})):t(e)},error:function(e){t(JSON.parse(e))}})}function X(e,n){var t=new CustomEvent(e,n);a.dispatchEvent?a.dispatchEvent(t):a.fireEvent(t)}function U(e){console.log("receive iframe message:"+JSON.stringify(e));var n=e.data;switch(n.type){case"TO_CANCEL_MATCH":K(!1),X("kaixinVs_match_cancel",null);break;case"TO_DISCONNECT":K(c.vs.connected=!1),X("kaixinVs_disconnect",{});break;case"TO_CONNECTED":c.vs.connected=!0;break;case"TO_START_GAME":X("kaixinVs_startGame",{}),K(!1);break;case"TO_SYNC_GAME_DATA_OTHERS":X("kaixinVs_syncOtherPlayerData",n.msg)}}function j(e){document.getElementById("vsFrame").contentWindow.postMessage(e,"*")}function K(e){var n=document.getElementById("vsFrame");n.style.display=e?"block":"none"}c.vs={},c.vs.connected=!1,c.vs.init=function(){return new Promise(function(e,n){var t;try{t=document.createElement('<iframe name="vsFrame" id="vsFrame" src="http://localhost" frameborder="0" scrolling="no" style="width:1px;min-width: 100%;*width:100%;height: 1px;min-height: 100%;*height:100%;position:absolute;top:0px;left:0px;"></iframe>')}catch(e){(t=document.createElement("iframe")).name="vsFrame",t.id="vsFrame",t.setAttribute("frameborder",0),t.setAttribute("scrolling","no"),t.setAttribute("style","width:1px;min-width: 100%;*width:100%;height: 1px;min-height: 100%;*height:100%;position:absolute;top:0px;left:0px;"),t.src="http://localhost"}document.body.appendChild(t),a.addEventListener("message",U),K(!(t.onload=function(){e()}))})},c.vs.initAndMatchPlayer=function(){var e={type:"init",msg:{}};e.msg.avatar=c.player.photo,e.msg.nickname=c.player.name,e.msg.uid=c.player.id,e.msg.token=O,e.msg.gameName=L,e.msg.orient=E,j(e),K(!0)},c.vs.broadGameData=function(e){j(e)},a.addEventListener("message",function(e){var n=e.data;"platform_token"==n.type&&localStorage.setItem("platform_token_os",n.msg)})}(window);